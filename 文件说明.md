项目文件功能与依赖概览（whisper_attack_Lang-Confusion）  

- `README.md`：中英文说明，依赖、用法、示例命令。  
- `run_attack.py`：对抗评估主入口，加载 hparams，构造源/目标 brain、攻击器，按测试集评估并保存 WER。  
- `fit_attacker.py`：训练攻击器入口，准备数据后调用 brain.fit。  
- `lang_attack.py`：语言检测攻击入口，准备 CommonVoice，训练/评估语言攻击。  
- `universal_lang_attack.py`：多语言通用攻击训练/评估入口。  
- `cw_whisper.py`：Carlini&Wagner 攻击实现，继承 robust_speech ImperceptibleASRAttack，重载第一阶段前向。  
- `loss.py`：Whisper 损失/解码封装，计算给定标签的交叉熵，用于攻击/分析。  
- `whisper_with_gradients.py`：Whisper 包装，保留对音频的梯度，便于白盒攻击。  
- `sb_whisper_binding.py`：Whisper 与 speechbrain 的桥接包装，提供最小 Brain。  
- `inference.py`：使用 HF 数据集对预计算对抗样本做推理并计算 WER。  
- `rand.py`：生成高斯噪声基线。  
- `cw.sh` / `pgd.sh` / `smooth.sh` / `lang.sh` / `rand.sh` / `inference.sh`：对应攻击/推理的示例脚本，调用 `run_attack.py` / `lang_attack.py` / `inference.py` 等。  
- `attack_configs/`：robust_speech 攻击配置（C&W、PGD、随机噪声、语言攻击、通用语言等），与 `run_attack.py` 搭配。  
- `model_configs/`：Whisper 模型加载配置（tiny/base/small/medium/large 及 smoothing 变体）。  
- `whisper_adversarial_examples/`：预计算对抗样本的数据集脚本。
- `tools/generate_librispeech_csv.py`：从 LibriSpeech 分割集生成 CSV，支持写入 lang 列并可选计算时长，便于自定义 fit_attacker/run_attack 数据。
- `LICENSE`：Apache-2.0。

## 通用对抗扰动训练示例命令

- **使用默认 CommonVoice 配置（英语攻击英语）**：
  ```bash
  python fit_attacker.py attack_configs/whisper/univ_lang_fit.yaml \
    --root=/你的/项目/路径 \
    --lang_attack=en --lang_CV=en \
    --model_label=medium \
    --batch_size=1 --nb_iter=1 --eps=0.005 --eps_item=0.001 \
    --rel_eps_iter=0.01 --epochs=10000 --success_every=100 --seed=1101
  ```

- **改用 LibriSpeech（英语攻击英语）**：先用 `tools/generate_librispeech_csv.py` 生成 `fit.csv`/`test-clean.csv`，再运行：
  ```bash
  python fit_attacker.py attack_configs/whisper/univ_lang_fit.yaml \
    --root=/你的/项目/路径 \
    --dataset_prepare_fct=robust_speech.data.librispeech.prepare_librispeech \
    --data_folder=/path/to/LibriSpeech \
    --csv_folder=/path/to/LibriSpeech/csv \
    --train_csv=/path/to/LibriSpeech/csv/fit.csv \
    --test_csv=/path/to/LibriSpeech/csv/test-clean.csv \
    --lang_attack=en --lang_CV=en \
    --model_label=medium \
    --load_audio=True --batch_size=1 --nb_iter=1 --eps=0.005 --eps_item=0.001 \
    --rel_eps_iter=0.01 --epochs=10000 --success_every=100 --seed=1101
  ```

> 以上命令均假设 `fit_attacker.py` 已通过 CSV 列校验，确保 `ID、duration、wav、wrd`（语言攻击还需 `lang`）列齐全。


source ~/.bashrc
